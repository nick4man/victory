<% content_for :title, "Сообщения" %>

<div class="py-6">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 md:px-8">
    <!-- Page header -->
    <div class="mb-8 flex items-center justify-between">
      <div>
        <h1 class="text-3xl font-bold text-gray-900">Сообщения</h1>
        <p class="mt-2 text-sm text-gray-600">
          <% if @unread_count > 0 %>
            У вас <%= @unread_count %> <%= Russian.p(@unread_count, 'непрочитанное сообщение', 'непрочитанных сообщения', 'непрочитанных сообщений') %>
          <% else %>
            Нет непрочитанных сообщений
          <% end %>
        </p>
      </div>

      <% if @unread_count > 0 %>
        <%= button_to mark_all_read_dashboard_messages_path, 
            method: :post,
            class: "inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50" do %>
          <svg class="-ml-1 mr-2 h-5 w-5 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          Отметить все как прочитанные
        <% end %>
      <% end %>
    </div>

    <% if @messages.any? %>
      <div class="bg-white shadow overflow-hidden sm:rounded-lg">
        <ul class="divide-y divide-gray-200">
          <% @messages.each do |message| %>
            <li>
              <%= link_to dashboard_message_path(message), 
                  class: "block hover:bg-gray-50 transition #{message.read? ? '' : 'bg-blue-50'}" do %>
                <div class="px-6 py-4">
                  <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center">
                      <% if message.sender.avatar_url.present? %>
                        <%= image_tag message.sender.avatar_url, class: "h-10 w-10 rounded-full object-cover" %>
                      <% else %>
                        <div class="h-10 w-10 rounded-full bg-primary-100 flex items-center justify-center">
                          <span class="text-primary-600 font-semibold">
                            <%= message.sender.initials %>
                          </span>
                        </div>
                      <% end %>
                      <div class="ml-3">
                        <p class="text-sm font-medium text-gray-900">
                          <%= message.sender.full_name %>
                        </p>
                        <p class="text-xs text-gray-500">
                          <%= l(message.created_at, format: :short) %>
                        </p>
                      </div>
                    </div>

                    <% unless message.read? %>
                      <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                        Новое
                      </span>
                    <% end %>
                  </div>

                  <p class="text-sm font-medium text-gray-900 mb-1">
                    <%= message.subject %>
                  </p>
                  
                  <p class="text-sm text-gray-600 line-clamp-2">
                    <%= message.body.truncate(150) %>
                  </p>

                  <% if message.property %>
                    <div class="mt-2 flex items-center text-xs text-gray-500">
                      <svg class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                              d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                      </svg>
                      <%= message.property.title.truncate(50) %>
                    </div>
                  <% end %>
                </div>
              <% end %>
            </li>
          <% end %>
        </ul>
      </div>

      <!-- Pagination -->
      <div class="mt-6 flex justify-center">
        <%= paginate @messages, theme: 'tailwind' %>
      </div>
    <% else %>
      <!-- Empty state -->
      <div class="bg-white shadow rounded-lg p-12">
        <div class="text-center">
          <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
          </svg>
          <h3 class="mt-2 text-sm font-medium text-gray-900">Нет сообщений</h3>
          <p class="mt-1 text-sm text-gray-500">
            У вас пока нет входящих сообщений
          </p>
        </div>
      </div>
    <% end %>
  </div>
</div>

