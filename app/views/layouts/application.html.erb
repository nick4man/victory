<!DOCTYPE html>
<html lang="<%= I18n.locale %>">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    
    <!-- SEO Meta Tags -->
    <%= display_meta_tags site: 'АН "Виктори"' %>
    <%= yield :meta_tags %>
    
    <!-- Favicon -->
    <%# Временно отключено: assets не найдены %>
    <%#= favicon_link_tag 'favicon.ico' %>
    <%#= favicon_link_tag 'favicon-16x16.png', rel: 'icon', type: 'image/png', sizes: '16x16' %>
    <%#= favicon_link_tag 'favicon-32x32.png', rel: 'icon', type: 'image/png', sizes: '32x32' %>
    <%#= favicon_link_tag 'apple-touch-icon.png', rel: 'apple-touch-icon', sizes: '180x180' %>
    
    <!-- Stylesheets -->
    <%# Временно отключено: assets не скомпилированы %>
    <%#= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%#= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    
    <!-- JavaScript -->
    <%= javascript_importmap_tags %>
    <%# Временно отключено: assets не скомпилированы %>
    <%#= javascript_include_tag "application", "data-turbo-track": "reload", defer: true %>
    
    <!-- Yandex.Metrika -->
    <% if ENV['YANDEX_METRIKA_ID'].present? %>
      <script type="text/javascript">
        (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
        (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
        ym(<%= ENV['YANDEX_METRIKA_ID'] %>, "init", {
          clickmap:true,
          trackLinks:true,
          accurateTrackBounce:true,
          webvisor:true
        });
      </script>
    <% end %>
    
    <!-- Google Analytics -->
    <% if ENV['GOOGLE_ANALYTICS_ID'].present? %>
      <script async src="https://www.googletagmanager.com/gtag/js?id=<%= ENV['GOOGLE_ANALYTICS_ID'] %>"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', '<%= ENV['GOOGLE_ANALYTICS_ID'] %>');
      </script>
    <% end %>
    
    <%= yield :head %>
  </head>

  <body class="min-h-screen bg-gray-50 flex flex-col" data-controller="app">
    <!-- Skip to main content (accessibility) -->
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 z-50 bg-primary-600 text-white px-4 py-2 rounded">
      Перейти к содержимому
    </a>

    <!-- Header -->
    <header class="bg-white border-b border-gray-200 sticky top-0 z-40 shadow-sm">
      <div class="container mx-auto px-4">
        <!-- Top Bar -->
        <div class="flex items-center justify-between py-2 text-sm border-b border-gray-100">
          <div class="flex items-center space-x-4 text-gray-600">
            <a href="tel:<%= ENV['COMPANY_PHONE'] %>" class="flex items-center hover:text-primary-600 transition">
              <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
              </svg>
              <%= ENV['COMPANY_PHONE'] %>
            </a>
            <span class="hidden md:inline text-gray-400">|</span>
            <span class="hidden md:inline">Ежедневно <%= ENV['WORKING_HOURS_START'] %>-<%= ENV['WORKING_HOURS_END'] %></span>
          </div>
          
          <div class="flex items-center space-x-4">
            <% if user_signed_in? %>
              <%= link_to dashboard_root_path, class: "flex items-center hover:text-primary-600 transition" do %>
                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                </svg>
                <%= current_user.first_name %>
              <% end %>
              <%= link_to "Выход", destroy_user_session_path, method: :delete, class: "hover:text-primary-600 transition" %>
            <% else %>
              <%= link_to "Войти", new_user_session_path, class: "hover:text-primary-600 transition" %>
              <span class="text-gray-400">|</span>
              <%= link_to "Регистрация", new_user_registration_path, class: "hover:text-primary-600 transition" %>
            <% end %>
          </div>
        </div>

        <!-- Main Navigation -->
        <nav class="flex items-center justify-between py-4">
          <!-- Logo -->
          <%= link_to root_path, class: "flex items-center" do %>
            <div class="text-2xl font-bold text-primary-600">
              АН "Виктори"
            </div>
          <% end %>

          <!-- Desktop Menu -->
          <div class="hidden lg:flex items-center space-x-6">
            <%= link_to "Купить", properties_path(q: { deal_type_eq: 'sale' }), class: "text-gray-700 hover:text-primary-600 transition font-medium" %>
            <%= link_to "Снять", properties_path(q: { deal_type_eq: 'rent' }), class: "text-gray-700 hover:text-primary-600 transition font-medium" %>
            <%= link_to "Продать", sell_evaluation_path, class: "text-gray-700 hover:text-primary-600 transition font-medium" %>
            <%= link_to "Сервисы", services_page_path, class: "text-gray-700 hover:text-primary-600 transition font-medium" %>
            <%= link_to "О компании", about_path, class: "text-gray-700 hover:text-primary-600 transition font-medium" %>
            <%= link_to "Контакты", contacts_path, class: "text-gray-700 hover:text-primary-600 transition font-medium" %>
          </div>

          <!-- Actions -->
          <div class="flex items-center space-x-4">
            <% if user_signed_in? %>
              <%= link_to dashboard_favorites_path, class: "relative p-2 text-gray-600 hover:text-primary-600 transition" do %>
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                </svg>
                <% if current_user.favorites_count > 0 %>
                  <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">
                    <%= current_user.favorites_count %>
                  </span>
                <% end %>
              <% end %>
            <% end %>

            <!-- Mobile Menu Button -->
            <button type="button" class="lg:hidden p-2 text-gray-600 hover:text-primary-600" data-action="click->app#toggleMobileMenu">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
              </svg>
            </button>
          </div>
        </nav>

        <!-- Mobile Menu -->
        <div class="lg:hidden hidden" data-app-target="mobileMenu">
          <div class="py-4 space-y-2">
            <%= link_to "Купить", properties_path(q: { deal_type_eq: 'sale' }), class: "block py-2 text-gray-700 hover:text-primary-600 transition" %>
            <%= link_to "Снять", properties_path(q: { deal_type_eq: 'rent' }), class: "block py-2 text-gray-700 hover:text-primary-600 transition" %>
            <%= link_to "Продать", sell_evaluation_path, class: "block py-2 text-gray-700 hover:text-primary-600 transition" %>
            <%= link_to "Сервисы", services_page_path, class: "block py-2 text-gray-700 hover:text-primary-600 transition" %>
            <%= link_to "О компании", about_path, class: "block py-2 text-gray-700 hover:text-primary-600 transition" %>
            <%= link_to "Контакты", contacts_path, class: "block py-2 text-gray-700 hover:text-primary-600 transition" %>
          </div>
        </div>
      </div>
    </header>

    <!-- Flash Messages -->
    <% if flash.any? %>
      <div class="container mx-auto px-4 py-4">
        <% flash.each do |type, message| %>
          <div class="alert alert-<%= type %> bg-<%= flash_color(type) %>-100 border border-<%= flash_color(type) %>-400 text-<%= flash_color(type) %>-700 px-4 py-3 rounded relative mb-4" role="alert">
            <span class="block sm:inline"><%= message %></span>
            <button type="button" class="absolute top-0 bottom-0 right-0 px-4 py-3" data-action="click->app#dismissAlert">
              <svg class="fill-current h-6 w-6 text-<%= flash_color(type) %>-500" role="button" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                <path d="M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"/>
              </svg>
            </button>
          </div>
        <% end %>
      </div>
    <% end %>

    <!-- Breadcrumbs -->
    <% if @breadcrumbs.present? %>
      <div class="bg-gray-100 border-b border-gray-200">
        <div class="container mx-auto px-4 py-3">
          <nav class="flex items-center space-x-2 text-sm text-gray-600">
            <%= link_to "Главная", root_path, class: "hover:text-primary-600 transition" %>
            <% @breadcrumbs.each_with_index do |crumb, index| %>
              <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
              </svg>
              <% if crumb[:path] %>
                <%= link_to crumb[:name], crumb[:path], class: "hover:text-primary-600 transition" %>
              <% else %>
                <span class="text-gray-900 font-medium"><%= crumb[:name] %></span>
              <% end %>
            <% end %>
          </nav>
        </div>
      </div>
    <% end %>

    <!-- Main Content -->
    <main id="main-content" class="flex-grow">
      <%= yield %>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-gray-300 mt-auto">
      <div class="container mx-auto px-4 py-12">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
          <!-- About -->
          <div>
            <h3 class="text-white text-lg font-bold mb-4">АН "Виктори"</h3>
            <p class="text-sm mb-4">
              Профессиональное агентство недвижимости. Помогаем найти идеальное жилье с 2010 года.
            </p>
            <div class="flex space-x-4">
              <% if ENV['SOCIAL_VK'].present? %>
                <a href="<%= ENV['SOCIAL_VK'] %>" target="_blank" class="hover:text-white transition">
                  <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M15.07 2H8.93C3.33 2 2 3.33 2 8.93v6.14C2 20.67 3.33 22 8.93 22h6.14c5.6 0 6.93-1.33 6.93-6.93V8.93C22 3.33 20.67 2 15.07 2z"/></svg>
                </a>
              <% end %>
              <% if ENV['SOCIAL_TELEGRAM'].present? %>
                <a href="<%= ENV['SOCIAL_TELEGRAM'] %>" target="_blank" class="hover:text-white transition">
                  <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"/></svg>
                </a>
              <% end %>
            </div>
          </div>

          <!-- Quick Links -->
          <div>
            <h3 class="text-white text-lg font-bold mb-4">Быстрые ссылки</h3>
            <ul class="space-y-2 text-sm">
              <li><%= link_to "Каталог недвижимости", properties_path, class: "hover:text-white transition" %></li>
              <li><%= link_to "Продать квартиру", sell_evaluation_path, class: "hover:text-white transition" %></li>
              <li><%= link_to "Ипотечный калькулятор", services_mortgage_calculator_path, class: "hover:text-white transition" %></li>
              <li><%= link_to "Юридические услуги", services_legal_services_path, class: "hover:text-white transition" %></li>
              <li><%= link_to "Виртуальные туры", services_virtual_tours_path, class: "hover:text-white transition" %></li>
            </ul>
          </div>

          <!-- Information -->
          <div>
            <h3 class="text-white text-lg font-bold mb-4">Информация</h3>
            <ul class="space-y-2 text-sm">
              <li><%= link_to "О компании", about_path, class: "hover:text-white transition" %></li>
              <li><%= link_to "Контакты", contacts_path, class: "hover:text-white transition" %></li>
              <li><%= link_to "Блог", blog_path, class: "hover:text-white transition" %></li>
              <li><%= link_to "FAQ", faq_path, class: "hover:text-white transition" %></li>
              <li><%= link_to "Политика конфиденциальности", privacy_path, class: "hover:text-white transition" %></li>
            </ul>
          </div>

          <!-- Contact -->
          <div>
            <h3 class="text-white text-lg font-bold mb-4">Контакты</h3>
            <ul class="space-y-3 text-sm">
              <li class="flex items-start">
                <svg class="w-5 h-5 mr-2 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
                <span><%= ENV['COMPANY_ADDRESS'] %></span>
              </li>
              <li class="flex items-center">
                <svg class="w-5 h-5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                </svg>
                <a href="tel:<%= ENV['COMPANY_PHONE'] %>" class="hover:text-white transition"><%= ENV['COMPANY_PHONE'] %></a>
              </li>
              <li class="flex items-center">
                <svg class="w-5 h-5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                </svg>
                <a href="mailto:<%= ENV['COMPANY_EMAIL'] %>" class="hover:text-white transition"><%= ENV['COMPANY_EMAIL'] %></a>
              </li>
            </ul>
          </div>
        </div>

        <!-- Bottom Bar -->
        <div class="border-t border-gray-800 mt-8 pt-8 text-sm text-center">
          <p>&copy; <%= Time.current.year %> АН "Виктори". Все права защищены.</p>
          <p class="mt-2">
            <%= link_to "Пользовательское соглашение", terms_path, class: "hover:text-white transition" %> |
            <%= link_to "Политика конфиденциальности", privacy_path, class: "hover:text-white transition" %>
          </p>
        </div>
      </div>
    </footer>

    <!-- Back to top button -->
    <button type="button" id="back-to-top" class="hidden fixed bottom-8 right-8 bg-primary-600 text-white p-3 rounded-full shadow-lg hover:bg-primary-700 transition z-50" data-action="click->app#scrollToTop">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"/>
      </svg>
    </button>

    <%= yield :scripts %>
  </body>
</html>