<% content_for :title, "Редактирование профиля" %>

<div class="min-h-screen bg-gray-50 py-12">
  <div class="mx-auto max-w-3xl px-4 sm:px-6 lg:px-8">
    <!-- Header -->
    <div class="mb-8">
      <nav class="flex mb-4" aria-label="Breadcrumb">
        <ol class="flex items-center space-x-2">
          <li>
            <%= link_to dashboard_path, class: "text-gray-400 hover:text-gray-600" do %>
              <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
              </svg>
            <% end %>
          </li>
          <li>
            <span class="text-gray-400">/</span>
          </li>
          <li>
            <span class="text-gray-900 font-medium">Редактирование профиля</span>
          </li>
        </ol>
      </nav>

      <h1 class="text-3xl font-bold text-gray-900">Редактирование профиля</h1>
      <p class="mt-2 text-sm text-gray-600">
        Обновите информацию вашего аккаунта
      </p>
    </div>

    <div class="bg-white shadow-xl rounded-2xl border border-gray-100 overflow-hidden">
      <%= form_for(resource, as: resource_name, url: registration_path(resource_name), html: { method: :put, class: "divide-y divide-gray-200" }) do |f| %>
        <%= render "devise/shared/error_messages", resource: resource %>

        <!-- Personal Information -->
        <div class="p-6 sm:p-8">
          <h2 class="text-lg font-semibold text-gray-900 mb-6">Личная информация</h2>
          
          <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
            <!-- First Name -->
            <div>
              <%= f.label :first_name, "Имя", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= f.text_field :first_name,
                  placeholder: "Иван",
                  class: "appearance-none block w-full px-3 py-3 border border-gray-300 rounded-lg placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition sm:text-sm" %>
            </div>

            <!-- Last Name -->
            <div>
              <%= f.label :last_name, "Фамилия", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= f.text_field :last_name,
                  placeholder: "Иванов",
                  class: "appearance-none block w-full px-3 py-3 border border-gray-300 rounded-lg placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition sm:text-sm" %>
            </div>

            <!-- Phone -->
            <div>
              <%= f.label :phone, "Телефон", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= f.telephone_field :phone,
                  placeholder: "+7 (999) 123-45-67",
                  data: { controller: "app", action: "input->app#formatPhone" },
                  class: "appearance-none block w-full px-3 py-3 border border-gray-300 rounded-lg placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition sm:text-sm" %>
            </div>

            <!-- Email -->
            <div>
              <%= f.label :email, "Email", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= f.email_field :email,
                  autocomplete: "email",
                  placeholder: "your@email.com",
                  class: "appearance-none block w-full px-3 py-3 border border-gray-300 rounded-lg placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition sm:text-sm" %>
              <% if devise_mapping.confirmable? && resource.pending_reconfirmation? %>
                <p class="mt-2 text-xs text-amber-600">
                  Ожидается подтверждение: <%= resource.unconfirmed_email %>
                </p>
              <% end %>
            </div>
          </div>
        </div>

        <!-- Password Change -->
        <div class="p-6 sm:p-8">
          <h2 class="text-lg font-semibold text-gray-900 mb-2">Изменить пароль</h2>
          <p class="text-sm text-gray-500 mb-6">Оставьте поля пустыми, если не хотите менять пароль</p>
          
          <div class="grid grid-cols-1 gap-6">
            <!-- New Password -->
            <div>
              <%= f.label :password, "Новый пароль", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= f.password_field :password,
                  autocomplete: "new-password",
                  placeholder: "Оставьте пустым, если не хотите менять",
                  class: "appearance-none block w-full px-3 py-3 border border-gray-300 rounded-lg placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition sm:text-sm" %>
              <% if @minimum_password_length %>
                <p class="mt-1 text-xs text-gray-500">Минимум <%= @minimum_password_length %> символов</p>
              <% end %>
            </div>

            <!-- Password Confirmation -->
            <div>
              <%= f.label :password_confirmation, "Подтверждение нового пароля", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= f.password_field :password_confirmation,
                  autocomplete: "new-password",
                  placeholder: "Повторите новый пароль",
                  class: "appearance-none block w-full px-3 py-3 border border-gray-300 rounded-lg placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition sm:text-sm" %>
            </div>

            <!-- Current Password (required for changes) -->
            <div>
              <%= f.label :current_password, "Текущий пароль", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= f.password_field :current_password,
                  autocomplete: "current-password",
                  placeholder: "Введите текущий пароль для подтверждения",
                  required: true,
                  class: "appearance-none block w-full px-3 py-3 border border-gray-300 rounded-lg placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition sm:text-sm" %>
              <p class="mt-1 text-xs text-gray-500">
                Требуется для подтверждения изменений
              </p>
            </div>
          </div>
        </div>

        <!-- Notification Preferences -->
        <div class="p-6 sm:p-8">
          <h2 class="text-lg font-semibold text-gray-900 mb-6">Настройки уведомлений</h2>
          
          <div class="space-y-4">
            <div class="flex items-start">
              <div class="flex items-center h-5">
                <%= check_box_tag :email_notifications, "1", true, class: "h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded transition cursor-pointer" %>
              </div>
              <div class="ml-3">
                <label for="email_notifications" class="font-medium text-gray-700 cursor-pointer">
                  Email уведомления
                </label>
                <p class="text-sm text-gray-500">Получать уведомления о новых объектах по email</p>
              </div>
            </div>

            <div class="flex items-start">
              <div class="flex items-center h-5">
                <%= check_box_tag :sms_notifications, "1", false, class: "h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded transition cursor-pointer" %>
              </div>
              <div class="ml-3">
                <label for="sms_notifications" class="font-medium text-gray-700 cursor-pointer">
                  SMS уведомления
                </label>
                <p class="text-sm text-gray-500">Получать важные уведомления по SMS</p>
              </div>
            </div>

            <div class="flex items-start">
              <div class="flex items-center h-5">
                <%= check_box_tag :marketing_emails, "1", true, class: "h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded transition cursor-pointer" %>
              </div>
              <div class="ml-3">
                <label for="marketing_emails" class="font-medium text-gray-700 cursor-pointer">
                  Рекламные рассылки
                </label>
                <p class="text-sm text-gray-500">Получать информацию о специальных предложениях</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Actions -->
        <div class="px-6 py-4 sm:px-8 bg-gray-50 flex flex-col sm:flex-row justify-between items-center gap-4">
          <div class="w-full sm:w-auto order-2 sm:order-1">
            <%= button_to "Удалить аккаунт",
                registration_path(resource_name),
                method: :delete,
                data: { 
                  turbo_method: :delete,
                  turbo_confirm: "Вы уверены? Это действие необратимо." 
                },
                class: "w-full sm:w-auto inline-flex justify-center items-center px-4 py-2 border border-red-300 rounded-lg shadow-sm text-sm font-medium text-red-700 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition" %>
          </div>
          
          <div class="flex gap-3 w-full sm:w-auto order-1 sm:order-2">
            <%= link_to "Отмена", :back, class: "flex-1 sm:flex-none inline-flex justify-center items-center px-4 py-2 border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition" %>
            
            <%= f.submit "Сохранить изменения", class: "flex-1 sm:flex-none inline-flex justify-center items-center px-6 py-2 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-gradient-to-r from-primary-600 to-primary-700 hover:from-primary-700 hover:to-primary-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition" %>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Account Info -->
    <div class="mt-6 bg-blue-50 border border-blue-100 rounded-lg p-4">
      <div class="flex">
        <div class="flex-shrink-0">
          <svg class="h-5 w-5 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </div>
        <div class="ml-3">
          <h3 class="text-sm font-medium text-blue-800">Информация об аккаунте</h3>
          <div class="mt-2 text-sm text-blue-700">
            <p>Дата регистрации: <%= l(resource.created_at, format: :long) %></p>
            <% if resource.current_sign_in_at %>
              <p class="mt-1">Последний вход: <%= time_ago_in_words(resource.current_sign_in_at) %> назад</p>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <!-- Back Link -->
    <div class="mt-6 text-center">
      <%= link_to dashboard_path, class: "text-sm text-gray-500 hover:text-gray-700 transition inline-flex items-center" do %>
        <svg class="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
        Вернуться в личный кабинет
      <% end %>
    </div>
  </div>
</div>

